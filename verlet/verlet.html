<!doctype html>
<html>
	<head>
		<title>Verlet 2D simulation</title>
		<meta charset = "utf-8" />
		<script src = "./particle.js"></script>
		<script src = "./spring.js"></script>
	</head>
	<body>
		<canvas height = "1000" width = "480" id = "canvas">Update Browser</canvas>
		<input type="button" onclick="clearInterval(timer)" value="Стоп">
		<script>
			var canv = document.getElementById("canvas"),
			    ctx =  canv.getContext("2d");
			var FILL_STYLE = "orange";
			var STROKE_STYLE = "green";
			ctx.fillStyle = FILL_STYLE;
			ctx.strokeStyle = STROKE_STYLE;
			var COLS = 30
			  , ROWS = 30;
			
			var diffX = 20;
			var diffY = 20;

			var particles = new Array(COLS * ROWS)
			  , springs = new Array((COLS -1) * ROWS + COLS * (ROWS -1));
			
			var i = 0;
			for (var r = 0; r < ROWS; r++) {
				for (var c = 0; c < COLS; c++) {
					particles[r * COLS + c] = new Particle(c * 10, r * 10);
					if (c > 0) {
						springs[i++] = new Spring(particles[r * COLS + c - 1], particles[r * COLS + c]);
					}
					if (r > 0) {
						springs[i++] = new Spring(particles[r * COLS + c], particles[(r - 1)* COLS + c]);
					}
				}
			}
		
			particles[0].st = 1;
			particles[COLS - 1].st = 1;

			var date = new Date();
			//var timer = setInterval(function() { console.log("++"); }, 1000 / 24);
			var timer = setInterval(function() {updateScene(); } , 1000 / 24);

			function updateScene() {
				//console.log("++");
				//return;
				var i = 0;
    			 	//renders
               			 var t = springs.length;
				for (i = 0; i < t; i++) {
					springs[i].contract();
				}

//				particles[0].setPos(0, 0);
//    				particles[COLS - 1].setPos(COLS * 10 + 20, 0);
                		t = particles.length
				for (i = 0; i < t; i++) {
					particles[i].fY += 0.01;
					particles[i].refresh();
				}

				drawScene();
			}

			function drawScene() {
				clearContext();
				ctx.beginPath();
				for (i = 0; i < springs.length; i++) {
					var spring = springs[i];
					ctx.moveTo(spring.a.x + diffX, spring.a.y + diffY);
					ctx.lineTo(spring.b.x + diffX, spring.b.y + diffY);
				}
				ctx.stroke();
			}

			function clearContext() {
				ctx.fillRect(0, 0, canv.width, canv.height);
			}
		</script>
	</body>
</html>
