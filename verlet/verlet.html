<!doctype html>
<html>
	<head>
		<title>Verlet 2D simulation</title>
		<meta charset = "utf-8" />
		<script src = "./point.js"></script>
		<script src = "./stick.js"></script>
	</head>
	<body>
		<canvas height = "1000" width = "480" id = "canvas">Update Browser</canvas>
		<input type="button" onclick="clearInterval(timer)" value="Стоп">
		<script>
			var canv = document.getElementById("canvas"),
			    ctx =  canv.getContext("2d");
			var FILL_STYLE = "orange";
			var STROKE_STYLE = "green";
			ctx.fillStyle = FILL_STYLE;
			ctx.strokeStyle = STROKE_STYLE;
			var COLS = 30
			  , ROWS = 30;
			
			var diffX = 20;
			var diffY = 20;

			var points = new Array(COLS * ROWS)
			  , sticks = new Array((COLS -1) * ROWS + COLS * (ROWS -1));
			
			var i = 0;
			for (var r = 0; r < ROWS; r++) {
				for (var c = 0; c < COLS; c++) {
					points[r * COLS + c] = new Point(c * 10, r * 10);
					if (c > 0) {
						sticks[i++] = new Stick(points[r * COLS + c - 1], points[r * COLS + c]);
					}
					if (r > 0) {
						sticks[i++] = new Stick(points[r * COLS + c], points[(r - 1)* COLS + c]);
					}
				}
			}
		

			var date = new Date();
			//var timer = setInterval(function() { console.log("++"); }, 1000 / 24);
			var timer = setInterval(function() {updateScene(); } , 1000 / 24);

			function updateScene() {
				//console.log("++");
				//return;
				var t = points.length;
				var i = 0;
				//renders
				points[0].setPos(0, 0);
				points[COLS - 1].setPos(COLS * 10 + 20, 0);
				for (i = 0; i < t; i++) {
					points[i].y += 0.1;
					points[i].refresh();
				}

				t = sticks.length;
				for (i = 0; i < t; i++) {
					sticks[i].contract();
				}
				drawScene();
			}

			function drawScene() {
				clearContext();
				ctx.beginPath();
				for (i = 0; i < sticks.length; i++) {
					var stick = sticks[i];
					ctx.moveTo(stick.a.x + diffX, stick.a.y + diffY);
					ctx.lineTo(stick.b.x + diffX, stick.b.y + diffY);
				}
				ctx.stroke();
			}

			function clearContext() {
				ctx.fillRect(0, 0, canv.width, canv.height);
			}
		</script>
	</body>
</html>
